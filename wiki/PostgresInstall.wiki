starting from scratch; postgresql

= Introduction =

This guide will show you how to setup an embedded instance of postgres using localhost. If you need to access the db from another host, modify accordingly. This config assumes you have trusted access to the instance from localhost.

Before you begin, you should consult the DiskLayout page for optimum database performance.

= Details =

 # Modify your postgres config
{{{
$ diff -u pg_hba.conf.orig pg_hba.conf
--- pg_hba.conf.orig	2010-09-02 12:06:29.000000000 +0000
+++ pg_hba.conf	2010-09-02 12:21:43.000000000 +0000
@@ -71,13 +71,13 @@
 # (autovacuum, daily cronjob, replication, and similar tasks).
 #
 # Database administrative login by UNIX sockets
-local   all         postgres                          ident sameuser
+local   all         postgres                          trust 
 
 # TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD
 
 # "local" is for Unix domain socket connections only
-local   all         all                               ident sameuser
+local   all         all                               trust 
 # IPv4 local connections:
-host    all         all         127.0.0.1/32          md5
+host    all         all         127.0.0.1/32          trust
 # IPv6 local connections:
-host    all         all         ::1/128               md5
+host    all         all         ::1/128               trust
}}}
 # set your kernel.shmmax (to about 1/2 - 2/3 the amount of system ram (this is a debian example):
{{{
$ sudo -s
# echo 4294967296 > /proc/sys/kernel/shmmax
}}}
 # modify your sysctl.conf to take effect on reboot:
{{{
kernel.shmmax = 4294967296
}}}
 # set the following values in postgresql.conf:
{{{
work_mem = 512MB
commit_delay = 30000
commit_siblings = 5         # range 1-1000
checkpoint_segments = 15
effective_cache_size = 4GB    # whatever you set shmmax to
log_min_messages = log # supress "key violation" errors (there will be lots of them)
}}}
 # restart postgres
{{{
$ sudo /etc/init.d/postgresql restart
}}}
 # make sure your user can:
{{{
$> psql -U postgres
postgres=#
postgres=#\l
                                 List of databases
   Name    |  Owner   | Encoding | Collation  |   Ctype    |   Access privileges   
-----------+----------+----------+------------+------------+-----------------------
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres
                                                           : postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres
                                                           : postgres=CTc/postgres
(3 rows)
}}}

= Performance Tuning =
 # http://developer.postgresql.org/pgdocs/postgres/kernel-resources.html
 # http://momjian.us/main/writings/pgsql/hw_performance/
 # http://www.revsys.com/writings/postgresql-performance.html
 # http://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server
 # http://wiki.postgresql.org/wiki/FAQ
 # http://www.thegeekstuff.com/2009/05/15-advanced-postgresql-commands-with-examples/
 # http://wiki.postgresql.org/wiki/Disk_Usage