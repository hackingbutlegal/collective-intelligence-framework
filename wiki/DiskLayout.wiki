#this page describes the best layout for your system disk and data-warehouse

= Introduction =

Disk layout is important, all the way down to the way you raid out your physical drives. On top of that, you should use LVM where-ever possible in case you run out of space. By default, the best bang for your buck is RAID5, as it will give you a good combination of performance and redundancy.

Where possible, you should:

 # mirror the main OS on it's own set of disks
 # mirror the main archive table space on it's own set of disks
 # RAID5 or even RAID0 the index table space (it can be rebuilt from the archive if the disks fail, a trade-off for speed)

= Details =
== Partition Mapping ==
 1. your index should grow at a rate of 80% - 90% of your archive
 1. the archive partition should be about 50-55% of your disk
 1. the index logical volume should be about 45-50% of your disk
 1. for 1GB of free space:
  * 550MB for the archive
  * 450MB for your index
 1. for 1TB of free space:
  * 550GB for the archive
  * 450GB for the index
 1. you shouldn't use up 100% of your "data drive", leave some slack space incase one of the partitions out-grows the other. For instance, instead of splitting the drive up "550GB / 450GB", split it up "500GB / 400GB", leaving 100GB of free space to re-allocate to either partition.
== LVM Example ==

 1. the /etc/fstab would look like:
{{{
/dev/mapper/vg00-archive /mnt/archive       ext3    defaults        0       2
/dev/mapper/vg00-index   /mnt/index         ext3    defaults        0       2
}}}
 1. after you've created your system via lvm, assuming your "data volume" is on vg00:
{{{
$ sudo lvcreate -n archive -L 550G vg00
$ sudo lvcreate -n index -L 450G vg00
$ sudo mkdir /mnt/archive
$ sudo mkdir /mnt/index
$ sudo mke2fs -j -m 2 /dev/mapper/vg00-index
$ sudo mke2fs -j /dev/mapper/vg00-archive
$ sudo mount /mnt/archive
$ sudo mount /mnt/index
$ sudo chown postgres:postgres /mnt/archive /mnt/index
$ sudo chmod 750 /mnt/archive /mnt/index
}}}
== Example Layout ==
{{{
/dev/mapper/vg00-root  6.5G  2.2G  4.0G  35% /
tmpfs                 2.0G     0  2.0G   0% /lib/init/rw
udev                  2.0G   96K  2.0G   1% /dev
tmpfs                 2.0G     0  2.0G   0% /dev/shm
/dev/sda1             228M   31M  186M  15% /boot
/dev/mapper/vg00-home  4.6G  200M  4.2G   5% /home

/dev/mapper/vg01-archive 550G   1G  549G  1% /mnt/archive
/dev/mapper/vg02-index 450G   1G  449G  1% /mnt/index
}}}