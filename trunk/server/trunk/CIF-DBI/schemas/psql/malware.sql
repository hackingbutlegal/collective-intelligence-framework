DROP TABLE IF EXISTS malware;

CREATE TABLE malware (
    id BIGSERIAL PRIMARY KEY NOT NULL,
    uuid uuid NOT NULL REFERENCES messages(uuid) ON DELETE CASCADE,
    description text,
    source uuid,
    hash_md5 varchar(32),
    hash_sha1 varchar(40),
    content bytea,
    impact VARCHAR(140),
    confidence REAL CHECK (confidence >= 0.0 AND 10.0 >= confidence),
    severity VARCHAR(6) CHECK (severity IN ('low','medium','high')),
    restriction VARCHAR(16) CHECK (restriction IN ('default','private','need-to-know','public')) DEFAULT 'private' NOT NULL,
    alternativeid text,
    alternativeid_restriction VARCHAR(16) CHECK (restriction IN ('default','private','need-to-know','public')) DEFAULT 'private' NOT NULL,
    detecttime timestamp with time zone,
    created timestamp with time zone DEFAULT NOW(),
    UNIQUE (uuid)
);
