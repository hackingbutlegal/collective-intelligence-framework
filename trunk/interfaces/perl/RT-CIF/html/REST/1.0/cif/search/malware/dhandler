<%ARGS>
$format  => 't'
</%ARGS>
<%INIT>
use RT::Interface::REST;
use CIF::Message::Malware;

my $output = "";
my $status = "200 Ok";

my $arg = $m->dhandler_arg();

my @recs;

for($arg){
    if(/^[a-zA-Z0-9]{32}$/){
        @recs = CIF::Message::Malware->search(hash_md5 => $arg);
        last;
    }
    if(/^[a-zA-Z0-9]{40}$/){
        @recs = CIF::Message::Malware->search(hash_sha1 => $arg);
        last;
    }
}

if($format eq 't'){
    $output = $m->comp('text', recs => \@recs);
} elsif($format eq 'xml'){
    $output = $m->comp('xml', recs => \@recs);
}

$m->out("RT/". $RT::VERSION . " " . $status ."\n\n");
$m->out($output);
</%INIT>
